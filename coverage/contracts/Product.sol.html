<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Product.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Product.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">67.86% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>19/28</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">25.68% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>19/74</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">60% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>9/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">61.9% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>26/42</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;
&nbsp;
import "@openzeppelin/contracts/utils/ReentrancyGuard.sol";
import "./AuthorizedContract.sol";
&nbsp;
/**
 * @title Product
 * @dev Contract representing a product in the e-commerce platform
 * Each product is defined by company address, id, name, price, and image
 */
contract Product is AuthorizedContract, ReentrancyGuard {
    constructor() Ownable(msg.sender) {}
    // Struct to represent a product
    struct ProductData {
        address companyAddress;
        uint256 id;
        string name;
        uint256 price; // Price in ECO tokens (with 18 decimals)
        string image; // IPFS hash or URL
        bool isActive;
        uint256 stock;
        uint256 creationDate;
        uint256 totalSold;
    }
    
    // Mapping from company address to mapping of product id to product data
    mapping(address =&gt; mapping(uint256 =&gt; ProductData)) public products;
    
    // Mapping from company address to array of product ids
    mapping(address =&gt; uint256[]) public companyProducts;
    
    // Global product counter for unique IDs across all companies
    uint256 public globalProductCounter;
    
    // Mapping to check if a product exists
    mapping(address =&gt; mapping(uint256 =&gt; bool)) public productExists;
    
    // Events
    event ProductCreated(
        address indexed companyAddress, 
        uint256 indexed id, 
        string name, 
        uint256 price, 
        string image,
        uint256 stock
    );
    event ProductUpdated(
        address indexed companyAddress, 
        uint256 indexed id, 
        string name, 
        uint256 price, 
        string image
    );
    event ProductStockUpdated(address indexed companyAddress, uint256 indexed id, uint256 newStock);
    event ProductDeactivated(address indexed companyAddress, uint256 indexed id);
    event ProductActivated(address indexed companyAddress, uint256 indexed id);
    event ProductActivated(address indexed companyAddress, uint256 indexed id, uint256 quantity);
    
    // Modifiers
    modifier onlyValidCompany(address companyAddress) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(companyAddress != address(0), "Product: Invalid company address");
        _;
    }
    
<span class="fstat-no" title="function not covered" >    modifier onlyProductOwner(address _companyAddress, uint256 _id) {</span>
<span class="cstat-no" title="statement not covered" >        require(</span>
            msg.sender == _companyAddress || msg.sender == owner(),
            "Product: Only product owner or contract owner can perform this action"
        );
        _;
    }
    
    modifier onlyExistingProduct(address _companyAddress, uint256 _id) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(productExists[_companyAddress][_id], "Product: Product does not exist");
        _;
    }
    
    
    /**
     * @dev Create a new product
     * @param _companyAddress Address of the company
     * @param _name Name of the product
     * @param _price Price in ECO tokens (with 18 decimals)
     * @param _image IPFS hash or URL of the product image
     * @param _stock Initial stock quantity
     * @return productId The ID of the created product
     */
    function createProduct(
        address _companyAddress,
        string memory _name,
        uint256 _price,
        string memory _image,
        uint256 _stock
    ) 
        external 
        <span class="missing-if-branch" title="else path not taken" >E</span>onlyValidCompany(_companyAddress) 
        <span class="missing-if-branch" title="else path not taken" >E</span>onlyAuthorized
        <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant 
        returns (uint256 productId) 
    {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(bytes(_name).length &gt; 0, "Product: Name cannot be empty");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_price &gt; 0, "Product: Price must be greater than 0");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(bytes(_image).length &gt; 0, "Product: Image cannot be empty");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_stock &gt; 0, "Product: Stock must be greater than 0");
        
        // Generate unique product ID
        productId = ++globalProductCounter;
        
        ProductData memory newProduct = ProductData({
            companyAddress: _companyAddress,
            id: productId,
            name: _name,
            price: _price,
            image: _image,
            isActive: true,
            stock: _stock,
            creationDate: block.timestamp,
            totalSold: 0
        });
        
        products[_companyAddress][productId] = newProduct;
        companyProducts[_companyAddress].push(productId);
        productExists[_companyAddress][productId] = true;
        
        emit ProductCreated(_companyAddress, productId, _name, _price, _image, _stock);
        return productId;
    }
    
    /**
     * @dev Update product information
     * @param _companyAddress Address of the company
     * @param _id Product ID
     * @param _name New name
     * @param _price New price
     * @param _image New image
     */
<span class="fstat-no" title="function not covered" >    function updateProduct(</span>
        address _companyAddress,
        uint256 _id,
        string memory _name,
        uint256 _price,
        string memory _image
    ) 
        external 
        onlyValidCompany(_companyAddress) 
        onlyExistingProduct(_companyAddress, _id) 
        onlyProductOwner(_companyAddress, _id) 
    {
<span class="cstat-no" title="statement not covered" >        require(bytes(_name).length &gt; 0, "Product: Name cannot be empty")</span>;
<span class="cstat-no" title="statement not covered" >        require(_price &gt; 0, "Product: Price must be greater than 0")</span>;
<span class="cstat-no" title="statement not covered" >        require(bytes(_image).length &gt; 0, "Product: Image cannot be empty")</span>;
        
        products[_companyAddress][_id].name = _name;
        products[_companyAddress][_id].price = _price;
        products[_companyAddress][_id].image = _image;
        
<span class="cstat-no" title="statement not covered" >        emit ProductUpdated(_companyAddress, _id, _name, _price, _image);</span>
    }
    
    /**
     * @dev Update product stock
     * @param _companyAddress Address of the company
     * @param _id Product ID
     * @param _newStock New stock quantity
     */
<span class="fstat-no" title="function not covered" >    function updateStock(</span>
        address _companyAddress,
        uint256 _id,
        uint256 _newStock
    ) 
        external 
        onlyValidCompany(_companyAddress) 
        onlyExistingProduct(_companyAddress, _id) 
        onlyProductOwner(_companyAddress, _id) 
    {
        products[_companyAddress][_id].stock = _newStock;
        
<span class="cstat-no" title="statement not covered" >        emit ProductStockUpdated(_companyAddress, _id, _newStock);</span>
    }
    
    /**
     * @dev Deactivate a product
     * @param _companyAddress Address of the company
     * @param _id Product ID
     */
<span class="fstat-no" title="function not covered" >    function deactivateProduct(</span>
        address _companyAddress,
        uint256 _id
    ) 
        external 
        onlyValidCompany(_companyAddress) 
        onlyExistingProduct(_companyAddress, _id) 
        onlyProductOwner(_companyAddress, _id) 
    {
        products[_companyAddress][_id].isActive = false;
        
<span class="cstat-no" title="statement not covered" >        emit ProductDeactivated(_companyAddress, _id);</span>
    }
    
    /**
     * @dev Activate a product
     * @param _companyAddress Address of the company
     * @param _id Product ID
     */
<span class="fstat-no" title="function not covered" >    function activateProduct(</span>
        address _companyAddress,
        uint256 _id
    ) 
        external 
        onlyValidCompany(_companyAddress) 
        onlyExistingProduct(_companyAddress, _id) 
        onlyProductOwner(_companyAddress, _id) 
    {
        products[_companyAddress][_id].isActive = true;
        
<span class="cstat-no" title="statement not covered" >        emit ProductActivated(_companyAddress, _id);</span>
    }
    
    /**
     * @dev Process product sale (called by ecommerce contract)
     * @param _companyAddress Address of the company
     * @param _id Product ID
     * @param _quantity Quantity sold
     */
    function processSale(
        address _companyAddress,
        uint256 _id,
        uint256 _quantity
    ) 
        external 
        <span class="missing-if-branch" title="else path not taken" >E</span>onlyValidCompany(_companyAddress) 
        <span class="missing-if-branch" title="else path not taken" >E</span>onlyExistingProduct(_companyAddress, _id) 
    {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_quantity &gt; 0, "Product: Quantity must be greater than 0");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            products[_companyAddress][_id].stock &gt;= _quantity,
            "Product: Insufficient stock"
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            products[_companyAddress][_id].isActive,
            "Product: Product is not active"
        );
        
        products[_companyAddress][_id].stock -= _quantity;
        products[_companyAddress][_id].totalSold += _quantity;
        
        emit ProductActivated(_companyAddress, _id, _quantity);
    }
    
    /**
     * @dev Get product data
     * @param _companyAddress Address of the company
     * @param _id Product ID
     * @return ProductData struct containing all product information
     */
    function getProductData(
        address _companyAddress,
        uint256 _id
    ) 
        external 
        view 
        <span class="missing-if-branch" title="else path not taken" >E</span>onlyValidCompany(_companyAddress) 
        <span class="missing-if-branch" title="else path not taken" >E</span>onlyExistingProduct(_companyAddress, _id) 
        returns (ProductData memory) 
    {
        return products[_companyAddress][_id];
    }
    
    /**
     * @dev Get all product IDs for an company
     * @param _companyAddress Address of the company
     * @return Array of product IDs
     */
<span class="fstat-no" title="function not covered" >    function getCompanyProducts(address _companyAddress) </span>
        external 
        view 
        onlyValidCompany(_companyAddress) 
        returns (uint256[] memory) 
    {
<span class="cstat-no" title="statement not covered" >        return companyProducts[_companyAddress];</span>
    }
    
    /**
     * @dev Get product count for an company
     * @param companyAddress Address of the company
     * @return Number of products
     */
    function getProductCount(address companyAddress) 
        external 
        view 
        <span class="missing-if-branch" title="else path not taken" >E</span>onlyValidCompany(companyAddress) 
        returns (uint256) 
    {
        return companyProducts[companyAddress].length;
    }
    
    /**
     * @dev Check if a product is available for purchase
     * @param companyAddress Address of the company
     * @param id Product ID
     * @param quantity Desired quantity
     * @return True if product is available, false otherwise
     */
    function isProductAvailable(
        address companyAddress,
        uint256 id,
        uint256 quantity
    ) 
        external 
        view 
        <span class="missing-if-branch" title="else path not taken" >E</span>onlyValidCompany(companyAddress) 
        <span class="missing-if-branch" title="else path not taken" >E</span>onlyExistingProduct(companyAddress, id) 
        returns (bool) 
    {
        ProductData memory product = products[companyAddress][id];
        return product.isActive &amp;&amp; product.stock &gt;= quantity;
    }
    
    /**
     * @dev Get total number of products across all companies
     * @return Total count of products
     */
    function getTotalProducts() external view returns (uint256) {
        return globalProductCounter;
    }
    
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Sep 09 2025 14:42:19 GMT-0500 (Eastern Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
